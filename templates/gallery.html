{% extends "base.html" %}
{% block title %}Gallery – Too Much Sawce Catering{% endblock %}

{% block content %}
<style>
  .wrap{max-width:1200px;margin:0 auto;padding:0 16px}

  .head{text-align:center;margin:8px auto 22px}
  .head h1{color:#ffd700;margin-bottom:8px;font-size:clamp(1.9rem,1.2rem+2.5vw,2.6rem)}
  .head p{color:#efe8ff;max-width:860px;margin:0 auto}
  .actions{display:flex;justify-content:center;gap:10px;margin-top:10px}
  .btn{display:inline-block;background:#ffd700;color:#1a132b;font-weight:800;padding:10px 16px;border-radius:12px;text-decoration:none;box-shadow:0 10px 24px rgba(255,215,0,.25);transition:.2s}
  .btn:hover{transform:translateY(-2px);box-shadow:0 14px 28px rgba(255,215,0,.35)}

  /* Grid */
  .grid{display:grid;gap:12px;margin-top:18px}
  /* auto-fit to keep rows balanced and avoid tiny columns on large screens */
  .grid{grid-template-columns:repeat(auto-fit, minmax(220px, 1fr))}
  @media (max-width:520px){ .grid{grid-template-columns:1fr} }

  .tile{
    position:relative; border-radius:14px; overflow:hidden;
    background:rgba(255,255,255,.04); border:1px solid rgba(255,215,0,.16);
    cursor:pointer; aspect-ratio:1/1; transition:transform .18s ease, box-shadow .18s ease;
  }
  .tile:hover{ transform:translateY(-2px); box-shadow:0 8px 18px rgba(0,0,0,.25) }
  .tile img{width:100%; height:100%; object-fit:cover; display:block; transform:scale(1.001)}

  /* Lightbox */
  .lightbox{position:fixed; inset:0; background:rgba(10,6,18,.92); display:none; align-items:center; justify-content:center; z-index:1000; padding:16px}
  .lightbox.open{display:flex}
  .lightbox img{max-width:96vw; max-height:88vh; border-radius:12px; display:block}

  .lb-btn{
    position:absolute; top:50%; transform:translateY(-50%);
    background:#ffd700; color:#1a132b; border:0; border-radius:10px; cursor:pointer;
    font-weight:800; line-height:1; padding:10px 12px; font-size:18px; box-shadow:0 8px 18px rgba(0,0,0,.25)
  }
  .lb-prev{left:16px} .lb-next{right:16px}
  .lb-close{top:16px; right:16px; transform:none; position:absolute}

  .count{position:absolute; bottom:12px; left:50%; transform:translateX(-50%); color:#ffd700; font-weight:700; background:rgba(26,19,43,.65); padding:6px 10px; border-radius:10px; border:1px solid rgba(255,215,0,.35)}
</style>

<div class="wrap">
  <header class="head">
    <h1>Gallery</h1>
    <p>A larger look at our recent plates, prep, and event spreads.</p>
    <div class="actions">
      <a class="btn" href="{{ back_url }}">← Back</a>
      <a class="btn" href="{{ url_for('contact') }}">Request A Quote</a>
    </div>
  </header>

  {% if images and images|length > 0 %}
  <section aria-label="Full gallery">
    <div class="grid" id="grid">
      {% for img in images %}
      <figure class="tile" data-i="{{ loop.index0 }}" data-src="{{ url_for('static', filename=img) }}">
        <img
          src="{{ url_for('static', filename=img) }}"
          alt="Dish photo {{ loop.index }}"
          loading="lazy"
          width="600" height="600">
      </figure>
      {% endfor %}
    </div>
  </section>
  {% else %}
    <p style="text-align:center;color:#e7defa;margin-top:18px">Gallery coming soon.</p>
  {% endif %}
</div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox" aria-hidden="true">
  <button class="lb-btn lb-close" aria-label="Close">×</button>
  <button class="lb-btn lb-prev" aria-label="Previous">‹</button>
  <img alt="Dish photo">
  <div class="count" id="lbCount" aria-live="polite"></div>
  <button class="lb-btn lb-next" aria-label="Next">›</button>
</div>

<script>
  (function(){
    const grid = document.getElementById('grid');
    const lb = document.getElementById('lightbox');
    if(!grid || !lb) return;

    const imgEl = lb.querySelector('img');
    const prev = lb.querySelector('.lb-prev');
    const next = lb.querySelector('.lb-next');
    const closeBtn = lb.querySelector('.lb-close');
    const count = document.getElementById('lbCount');

    const tiles = Array.from(grid.querySelectorAll('.tile'));
    const sources = tiles.map(t => t.dataset.src);
    let idx = 0, touchStartX = null;

    function update(){
      imgEl.src = sources[idx];
      count.textContent = (idx+1) + " / " + sources.length;
    }
    function openAt(i){
      if(!sources.length) return;
      idx = (i + sources.length) % sources.length;
      update();
      lb.classList.add('open');
      lb.setAttribute('aria-hidden','false');
    }
    function close(){
      lb.classList.remove('open');
      lb.setAttribute('aria-hidden','true');
      imgEl.src = '';
    }
    function nextImg(){ idx = (idx+1) % sources.length; update(); }
    function prevImg(){ idx = (idx-1+sources.length) % sources.length; update(); }

    grid.addEventListener('click', e=>{
      const fig = e.target.closest('.tile');
      if(!fig) return;
      openAt(parseInt(fig.dataset.i,10)||0);
    });

    next.addEventListener('click', nextImg);
    prev.addEventListener('click', prevImg);
    closeBtn.addEventListener('click', close);
    lb.addEventListener('click', e=>{ if(e.target===lb) close(); });
    document.addEventListener('keydown', e=>{
      if(!lb.classList.contains('open')) return;
      if(e.key==='Escape') close();
      if(e.key==='ArrowRight') nextImg();
      if(e.key==='ArrowLeft') prevImg();
    });

    // simple swipe
    imgEl.addEventListener('touchstart', e=>{ touchStartX = e.touches[0].clientX; }, {passive:true});
    imgEl.addEventListener('touchmove', e=>{
      if(touchStartX===null) return;
      const dx = e.touches[0].clientX - touchStartX;
      if(Math.abs(dx)>60){ dx>0 ? prevImg() : nextImg(); touchStartX = null; }
    }, {passive:true});
    imgEl.addEventListener('touchend', ()=>{ touchStartX = null; });
  })();
</script>
{% endblock %}
